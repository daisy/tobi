<UI:SortableListView
  x:Class="Tobi.Modules.MetadataPane.MetadataPaneView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:UI="clr-namespace:Tobi.Infrastructure.UI;assembly=Tobi.Infrastructure"
    xmlns:local="clr-namespace:Frustration"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch"
    x:Name="list"
    ItemsSource="{Binding Metadatas, Mode=OneWay}"
    SelectionMode="Single"
    ScrollViewer.HorizontalScrollBarVisibility="Visible"
    ScrollViewer.VerticalScrollBarVisibility="Visible"
    AlternationCount="2">
    
    <ListView.Resources>
        <DataTemplate x:Key="ReadOnlyTemplate">
            <StackPanel>
                <TextBlock Text="{Binding Content}" Background="AliceBlue"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="OptionalStringTemplate">
            <TextBox Text="{Binding Content}" Background="Yellow"/>
        </DataTemplate>
        
        <DataTemplate x:Key="RequiredStringTemplate">
            <TextBox Background="BurlyWood">
                
                <TextBox.Text>
                    <Binding Path="Content">
                        <Binding.ValidationRules>
                            <local:RequiredStringValidationRule ErrorMessage="Field cannot be empty."/>
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
        </DataTemplate>
       
        <DataTemplate x:Key="OptionalDateTemplate">
            <TextBox Background="Green"><!-- Validation.ErrorTemplate="{StaticResource ErrorTemplate}"> -->
                <TextBox.Text>
                    <Binding Path="Content">
                        <Binding.ValidationRules>
                            <local:OptionalDateValidationRule ErrorMessage="Please format date as YYYY-MM-DD"/>
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
        </DataTemplate>

        <DataTemplate x:Key="RequiredDateTemplate">
            <TextBox Background="LightBlue"><!-- Validation.ErrorTemplate="{StaticResource ErrorTemplate}">-->
                <TextBox.Text>
                    <Binding Path="Content">
                        <Binding.ValidationRules>
                            <local:RequiredDateValidationRule ErrorMessage="Please format date as YYYY-MM-DD"/>
                        </Binding.ValidationRules>
                    </Binding>
                </TextBox.Text>
            </TextBox>
        </DataTemplate>

        <ControlTemplate x:Key="ErrorTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox BorderBrush="Red" Background="Pink" 
                         ToolTip="{Binding RelativeSource={RelativeSource Self}, 
                                   Path=(Validation.Errors)[0].ErrorContent}">
                    <Binding Path="Content"/>
                </TextBox>
                <TextBlock Foreground="Red" Text="!!"/>
            </StackPanel>
        </ControlTemplate>

        <local:MetadataTypeTemplateSelector 
            RequiredDateTemplate="{StaticResource RequiredDateTemplate}"
            RequiredStringTemplate="{StaticResource RequiredStringTemplate}"
            OptionalStringTemplate="{StaticResource OptionalStringTemplate}" 
            OptionalDateTemplate="{StaticResource OptionalDateTemplate}"
            ReadOnlyTemplate="{StaticResource ReadOnlyTemplate}" 
            DefaultTemplate="{StaticResource OptionalStringTemplate}"
            x:Key="metadataTemplateSelector" />
        
    </ListView.Resources>
    
    <ListView.View>
    <GridView AllowsColumnReorder="false">
      <GridViewColumn Header="Name"
                      UI:SortableListView.SortPropertyName="Name"
                      DisplayMemberBinding="{Binding Name}"/>

      <GridViewColumn Header="Content"
                      UI:SortableListView.SortPropertyName="Content"
                      CellTemplateSelector="{StaticResource metadataTemplateSelector}"/>
    </GridView>
  </ListView.View>
  <ListView.ItemContainerStyle>

    <Style TargetType="{x:Type ListViewItem}">
      <Style.Triggers>
        <Trigger Property="ItemsControl.AlternationIndex" Value="0">
          <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
        </Trigger>
        <!-- Trigger Property="ItemsControl.AlternationIndex" Value="1">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
          </Trigger -->
      </Style.Triggers>
    </Style>

  </ListView.ItemContainerStyle>
</UI:SortableListView>

